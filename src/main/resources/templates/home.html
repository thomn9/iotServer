<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Rezervační aplikace</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js" integrity="sha512-tL4PIUsPy+Rks1go4kQG8M8/ItpRMvKnbBjQm4d2DQnFwgcBYRRN00QdyQnWSCwNMsoY/MfJY8nHp2CzlNdtZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.js" integrity="sha512-aHuAnb+FZ/yM5zYvdiA8q0sxLdsBQ3PRwO8D/08qsenCLQ2gWsosB43Cn1X8esAz0IpaC7Ns5cAPyKIdJQ0hNw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        var stompClient = null;
        function setConnected(connected) {
            document.getElementById('connect').disabled = connected;
            document.getElementById('disconnect').disabled = !connected;
            document.getElementById('conversationDiv').style.visibility
                = connected ? 'visible' : 'hidden';
            document.getElementById('response').innerHTML = '';
        }

        function connect() {
            var socket = new SockJS('/reservation');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/reservable-schedule', function(messageOutput) {
                    console.log(':::::::::::::::someMessage"""""""""""""""""""""');
                    showMessageOutput(JSON.parse(messageOutput));
                });
            });
        }

        function disconnect() {
            if(stompClient != null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function lockReservableSchedule() {
            stompClient.send("/app/reservation", {},
                JSON.stringify(
                    {'wsAction':"LOCK",
                    'reservableScheduleId':1,
                    'reservationCode': null,
                    'reservationBaseDto': null
                    }));
        }

        function sendMessage() {
            var from = document.getElementById('from').value;
            var text = document.getElementById('text').value;
            stompClient.send("/app/reservation", {},
                JSON.stringify({'from':from, 'text':text}));
        }

        function showMessageOutput(messageOutput) {
            console.log('someMessage"""""""""""""""""""""');
            var response = document.getElementById('response');
            var p = document.createElement('p');
            p.style = 'break-word';
            p.appendChild(document.createTextNode(messageOutput.from + ": "
                + messageOutput.text + " (" + messageOutput.time + ")"));
            response.appendChild(p);
        }
    </script>
</head>
<body onload="connect()">
<button id="connect" onclick="connect();">Connect</button>
<button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
<!--<div class="container">
    <h2>Vytvoření rezervace</h2>
    <form onsubmit="" method="post" th:action="@{/submit-form}" th:object="${meteorologicaldata}">
        <div class="form-group">
            <label for="temperature">Teplota ve °C</label>
            <input id="temperature" class="form-control" th:field="*{temperature}">
        </div>
        <div class="form-group">
            <label for="humidity">Vzdušná vlhkost</label>
            <input id="humidity" class="form-control" th:field="*{humidity}">
        </div>
        <div class="form-group">
            <label for="pressure">Atmosférický tlak</label>
            <input id="pressure" class="form-control" th:field="*{pressure}">
        </div>
        <div class="form-group">
            <label for="light">UV index</label>
            <input id="light" class="form-control" th:field="*{light}">
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Vytvořit rezeravci....</button>

        </div>
    </form>
</div>-->
<button onclick="lockReservableSchedule()" class="btn btn-primary">Vytvořit rezeravci</button>
<div class="container">
    <h2>Termíny rezervací</h2>
    <table class="table-striped table table-hover table-dark">
        <thead>
        <tr>
            <th>Datum</th>
            <th>Od</th>
            <th>Do</th>
            <th>Stav</th>
            <th>Id služby</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="reservableScheduleRecord : ${reservableSchedule}">
            <td th:text="${reservableScheduleRecord.getReservationDate()}"></td>
            <td th:text="${reservableScheduleRecord.getReservableTimeWindow().getMinimum()}"></td>
            <td th:text="${reservableScheduleRecord.getReservableTimeWindow().getMaximum()}"></td>
            <td th:text="${reservableScheduleRecord.getReservableState()}"></td>
            <td th:text="${reservableScheduleRecord.getServiceDefinitionId()}"></td>
            <td><button type="submit" class="btn btn-primary">Vybrat</button></td>
        </tr>
        </tbody>
        <tfoot>
        </tfoot>
    </table>
</div>

</body>
</html>